using System;
using System.Runtime.InteropServices;

namespace PvrDatabase
{
    public static class PvrConstants
    {
        public const int MAX_DVR_FILENAME_LEN = 256;
        public const int MAX_PGM_NAME_LEN = 256;
        public const int MAX_PGM_DESC_LEN = 512;
        public const int MAX_TRANSFER_CLIENT = 10;
        public const int MAX_TRNSD_CLIENTID_LEN = 64;
        public const int MAX_CLIENTID_LEN = 64;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1, CharSet = CharSet.Ansi)]
    public struct PVR_SeriesData
    {
        public ushort numbgrToKeep;
        public byte seriesFlags;
        public byte dayMask;
        public byte matchHour;
        public byte matchMinute;
        public uint RecHistoryCause;
        public uint unused2;
        public uint unused3;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_PGM_NAME_LEN)]
        public string aucSeriesName;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_PGM_DESC_LEN)]
        public string aucSeriesDescription;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1, CharSet = CharSet.Ansi)]
    public struct PVR_SyncNGoData
    {
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_DVR_FILENAME_LEN)]
        public string dvrFileName;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_DVR_FILENAME_LEN)]
        public string trnsdfFileName;
        public byte transcodeType;
        public byte resolution;
        public byte audiolang;
        public byte transdStatus;
        public ushort bitRate;
        public ushort syncFlags;
        [MarshalAs(UnmanagedType.U1)]
        public bool bDVSEnabled;
        [MarshalAs(UnmanagedType.U1)]
        public bool bAdaptionEnabled;
        public ushort copyCount;
        public uint unused1;
        public uint unused2;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_PGM_NAME_LEN)]
        public string aucProgName;
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = PvrConstants.MAX_TRANSFER_CLIENT * PvrConstants.MAX_TRNSD_CLIENTID_LEN)]
        public byte[] unused3;
        [MarshalAs(UnmanagedType.ByValArray, SizeConst = PvrConstants.MAX_TRANSFER_CLIENT * PvrConstants.MAX_TRNSD_CLIENTID_LEN)]
        public byte[] unused4;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    public struct PVR_InstanceData
    {
        public long planned_RecStart;
        public uint planned_RecDuration;
        public long estDeletion;
        public double recStart;
        public double recDuration;
        public double pbPosition;
        public uint platformContentID;
        public uint RecHistoryCause;
        public uint unused2;
        public ushort instanceFlags;
        public ushort unused4;
        public uint fromParentID;
    }

    [StructLayout(LayoutKind.Explicit, Pack = 1, Size = 1024)] // Adjust size as needed
    public struct PVR_DataUnion
    {
        [FieldOffset(0)]
        public PVR_InstanceData instanceData;
        [FieldOffset(0)]
        public PVR_SeriesData seriesData;
        [FieldOffset(0)]
        public PVR_SyncNGoData syncData;
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1, CharSet = CharSet.Ansi)]
    public struct PVR_DBRec
    {
        public uint pvr_id;
        public uint programID;
        public uint ui32SeriesID;
        public long guideStartSeconds;
        public long scheduleTime;
        public PVR_DataUnion pvrData;
        public ushort dataLen;
        public ushort title;
        public ushort shortDescription;
        public ushort filenameRoot;
        public ushort moreInfo;
        public ushort serviceID;
        public ushort dispChannel;
        public ushort guideRunningTime;
        public ushort qualifiers;
        public ushort callLetters;
        public ushort pvrFlags;
        public byte category;
        public byte eventFlags;
        public byte showtimeFlags1;
        private byte _ratingByte;
        public byte contentAdvisory;
        public byte pvrRecordType;
        public byte earlyMinutes;
        public byte lateMinutes;
        public byte recordQuality;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_CLIENTID_LEN)]
        public string ClientID;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = PvrConstants.MAX_CLIENTID_LEN)]
        public string eventClientId;
        public uint unused5;
        public uint unused6;
        public IntPtr vardata;

        public byte MpaaRating
        {
            get => (byte)(_ratingByte & 0x0F);
            set => _ratingByte = (byte)((_ratingByte & 0xF0) | (value & 0x0F));
        }
        
        public byte SvldRating
        {
            get => (byte)((_ratingByte & 0xF0) >> 4);
            set => _ratingByte = (byte)((_ratingByte & 0x0F) | ((value & 0x0F) << 4));
        }
    }
}
